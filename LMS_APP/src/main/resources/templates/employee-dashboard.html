<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Employee Dashboard</title>
    <meta charset="UTF-8"/>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #f1f5f9;
        }

        header {
            background: #1e293b;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
        }

        .container {
            padding: 30px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .balance-box {
            background: #2563eb;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 18px;
        }

        input, select {
            padding: 8px;
            margin: 5px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        button {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            background: #2563eb;
            color: white;
            cursor: pointer;
        }

        button:hover {
            background: #1e40af;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #2563eb;
            color: white;
            padding: 10px;
        }

        td {
            padding: 10px;
            text-align: center;
        }

        tr:nth-child(even) {
            background: #e2e8f0;
        }

        .badge {
            padding: 5px 10px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
        }

        .approved { background: #16a34a; }
        .rejected { background: #dc2626; }
        .pending  { background: #f59e0b; }

        .days-display {
            font-weight: bold;
            margin-left: 10px;
            color: #2563eb;
        }

        .alert-error {
            background: #fee2e2;
            color: #b91c1c;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .alert-success {
            background: #dcfce7;
            color: #166534;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
        }

    </style>
</head>
<body>

<header>
    <div>Employee Dashboard</div>
    <div>
        Welcome, <b th:text="${employeeName}"></b> |
        <a th:href="@{/logout}" style="color:#38bdf8;">Logout</a>
    </div>
</header>

<div class="container">

    <!-- Leave Balance -->
    <div class="balance-box">
        Leave Balance:
        <b th:text="${leaveBalance} + ' Days Remaining'"></b>
    </div>

    <!-- Messages -->
    <div th:if="${error}" class="alert-error" th:text="${error}"></div>
    <div th:if="${success}" class="alert-success" th:text="${success}"></div>

    <!-- Apply Leave -->
    <div class="card">
        <h3>Apply for Leave</h3>

        <form th:action="@{/employee/apply}" method="post">

            <label>Leave Type:</label>
            <select name="leaveType" required>
                <option value="" disabled selected>Select Leave Type</option>
                <option value="Annual Leave">ðŸŒ´ Annual Leave</option>
                <option value="Sick Leave">ðŸ¤’ Sick Leave</option>
                <option value="Maternity Leave">ðŸ‘¶ Maternity Leave</option>
                <option value="Study Leave">ðŸ“š Study Leave</option>
                <option value="Unpaid Leave">ðŸ’¼ Unpaid Leave</option>
            </select>

            <br><br>

            <label>Start Date:</label>
            <input id="startDate" name="startDate" type="date" required/>

            <label>End Date:</label>
            <input id="endDate" name="endDate" type="date" required/>

            <span class="days-display" id="daysCount"></span>

            <br><br>

            <label>Reason:</label>
            <input name="reason" placeholder="Reason" required/>

            <br><br>

            <button type="submit">Submit Leave Request</button>

        </form>
    </div>

    <!-- Leave Status Table -->
    <div class="card">
        <h3>Leave Status</h3>

        <table>
            <tr>
                <th>Type</th>
                <th>Start</th>
                <th>End</th>
                <th>Status</th>
            </tr>

            <tr th:each="l : ${leaves}">
                <td th:text="${l.leaveType}"></td>
                <td th:text="${l.startDate}"></td>
                <td th:text="${l.endDate}"></td>

                <td>
                    <span th:if="${l.status.name() == 'APPROVED'}"
                          class="badge approved">Approved</span>

                    <span th:if="${l.status.name() == 'REJECTED'}"
                          class="badge rejected">Rejected</span>

                    <span th:if="${l.status.name() == 'PENDING'}"
                          class="badge pending">Pending</span>
                </td>
            </tr>

        </table>
    </div>

</div>

<!-- JavaScript -->
<script>

    const startInput = document.getElementById("startDate");
    const endInput = document.getElementById("endDate");
    const daysDisplay = document.getElementById("daysCount");

    const today = new Date().toISOString().split("T")[0];
    startInput.setAttribute("min", today);
    endInput.setAttribute("min", today);

    function calculateDays() {
        if (startInput.value && endInput.value) {
            const start = new Date(startInput.value);
            const end = new Date(endInput.value);

            if (end >= start) {
                const diffTime = end - start;
                const diffDays = diffTime / (1000 * 60 * 60 * 24) + 1;
                daysDisplay.textContent = diffDays + " day(s)";
            } else {
                daysDisplay.textContent = "Invalid dates";
            }
        }
    }

    startInput.addEventListener("change", calculateDays);
    endInput.addEventListener("change", calculateDays);

</script>

</body>
</html>